<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <title>Rabbi Map - Atlantic Synagogues</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap" rel="stylesheet">    <link rel="stylesheet" href="https://eam5.github.io/atlanticsynagogues/assets/css/main.css">
    <link rel="stylesheet" href="https://eam5.github.io/atlanticsynagogues/assets/css/main.css">
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.13.1/lodash.js'></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
    integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
    crossorigin=""/>
 
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
   integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
   crossorigin=""></script>
 
</head>
<body>
  <nav class="navbar navbar-expand-md navbar-light bg-light">
  <a class="navbar-brand" href="https://eam5.github.io/atlanticsynagogues">Atlantic Synagogues</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarCollapse">
      <div class="navbar-nav">
          
          <a class="nav-item nav-link" href="https://eam5.github.io/atlanticsynagogues/">Home</a>
          
          <a class="nav-item nav-link" href="https://eam5.github.io/atlanticsynagogues/index-tree">Synagogues</a>
          
          <a class="nav-item nav-link" href="https://eam5.github.io/atlanticsynagogues/images">Images</a>
          
          <a class="nav-item nav-link" href="https://eam5.github.io/atlanticsynagogues/synagogue-map">Synagogue Map</a>
          
          <a class="nav-item nav-link" href="https://eam5.github.io/atlanticsynagogues/contributions">Contributions</a>
          
          <a class="nav-item nav-link" href="https://eam5.github.io/atlanticsynagogues/access-paths">Access Paths</a>
          
          <a class="nav-item nav-link" href="https://eam5.github.io/atlanticsynagogues/allbldgs_allfac">Facade Fractal Trees</a>
          
          <a class="nav-item nav-link" href="https://eam5.github.io/atlanticsynagogues/scatter">Synagogue Timeline</a>
          
          <a class="nav-item nav-link" href="https://eam5.github.io/atlanticsynagogues/site-index">Site Index</a>
            
      </div>
  </div>
</nav>
  <div id="main" class="container-lg">
    <style>
    
    #mapid { height: 480px; width: 100%;}

    /* #vis {
        width:740px;
        height:480px;
        margin-top:1rem;
    } */
    circle {
        opacity: 0.4;
        cursor: pointer;
        pointer-events: auto !important;
    }
    .links {
        cursor: pointer;
        pointer-events: auto !important;
    }
    .tweet {
        padding: 0.5em 0.5em;
    }
    
    .date, .years {
        font-size: 0.9em;
    }
    
</style>
    <div class="d-flex flex-wrap align-items-baseline">
        <h1>Atlantic Synagogues: Rabbis</h1>
        <button id="allYears" class='btn btn-link'>(show all)</button>    
    </div>
<div class="d-flex flex-wrap align-items-baseline justify-content-between my-2">
    <button id="button1" type="button" class="btn btn-light btn-sm">1600-1650</button>
    <button id="button2" type="button" class="btn btn-light btn-sm">1650-1700</button>
    <button id="button3" type="button" class="btn btn-light btn-sm">1700-1750</button>
    <button id="button4" type="button" class="btn btn-light btn-sm">1750-1800</button>
    <button id="buttonAmst" type="button" class="btn btn-light btn-sm">Amsterdam</button>
    <button id="buttonLondon" type="button" class="btn btn-light btn-sm">London</button>
    <button id="buttonCuracao" type="button" class="btn btn-light btn-sm">Curacao</button>
    <button id="buttonNY" type="button" class="btn btn-light btn-sm">New York</button>
    <button id="buttonNewport" type="button" class="btn btn-light btn-sm">Newport, RI</button>
</div>
<div id="vis" class="d-flex flex-wrap">
    <div id="mapid"></div>
    <div class="flex-shrink-1 my-2">
        <div id="title"></div>
        <div id="travel"></div>
        <div id="rabbis"></div>
    </div>
</div> 
<script>
var travel = d3.select("#travel");
var rabbis = d3.select("#rabbis");

var springs = L.featureGroup(); //Same as L.layerGroup() but with more options.

var cartoUrl = 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png'
var cartoAttrib = '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'

var carto = L.tileLayer(cartoUrl, {subdomains: 'abcd', maxZoom: 18, attribution: cartoAttrib})
    
var map = L
    .map('mapid', {
        center: [28.079555, -26.940793],
        zoom: 3,
        layers: [carto, springs]
    });
    
    
function addLayer2(data, layer){
    L.svg({clickable:true}).addTo(layer);
const overlay = d3.select(map.getPanes().overlayPane)
const svg = overlay.select('svg').attr("pointer-events", "auto").append('g')

var titleMinYr = d3.min(data.map(d=>d.minYear));
        var titleMaxYr = d3.max(data.map(d=>d.maxYear));
        console.log(titleMinYr)
var title = d3.select("#title");
title.append("h3").text("Rabbis " + titleMinYr +"-" + titleMaxYr);

var defs = d3.select("#mapid")
  .select("svg").append("svg:defs")
.append("svg:marker")
    .attr("id", "triangle")
    .attr("refX", 6)
    .attr("refY", 6)
    .attr("markerWidth", 30)
    .attr("markerHeight", 30)
    .attr("markerUnits","userSpaceOnUse")
    .attr("orient", "auto")
    .append("path")
    .attr("d", "M 0 0 12 6 0 12 3 6");
    
    const links = svg.selectAll('path')
        .data(data)
        .enter().append('path')
        .attr('class', 'links')
        .attr('d', function(d){
            var sourcePt = map.latLngToLayerPoint([d.sourceX, d.sourceY])
            var targetPt = map.latLngToLayerPoint([d.targetX, d.targetY])
            var dx = targetPt.x - sourcePt.x,
            dy = targetPt.y - sourcePt.y,
            dr = Math.sqrt(dx * dx + dy * dy);
            return "M" + sourcePt.x + "," + sourcePt.y + "A" + dr + "," + dr + " 0 0,1 " + targetPt.x + "," + targetPt.y;
        })
        .attr("marker-end", function(d){
            if (d.source_location===d.target_location){return "none"}
            else {return "url(#triangle)"}
        })
        .attr('fill', 'none')
    .attr("stroke", function(d){ if(d.rabbis[0].idpeople=="25"){return "blue"} else {return "#17202A"}})
        .attr('stroke-width', d=>d.amount*2)
        .attr("opacity", 0.6)
    .on('click', function(d) {
        var location = this;
        d3.selectAll(".links").transition().style('opacity', function () {
            return (this === location) ? 1.0 : 0.6;
        });
        
        
        var titleLoc = d.sourceTarget;
        var number = d.amount;
        
        travel.text(titleLoc + " (" + number +")");
        
        var rabbiData = rabbis.selectAll(".tweet")
            .data(d.rabbis);
        rabbiData.enter().append('div')
            .attr("class", "tweet");
        rabbiData.exit().remove();
        
        rabbiData.selectAll('div').remove();
        
        rabbiData.append("div")
            .text(d=>d.name);
         rabbiData.append("div")
            .attr("class", "years")
            .text(d=> d.congregation_name + " (" + d.year_start + "-" + d.year_end +")")
        rabbiData.append("div")
            .attr("class", "date")
            .text(d=> "Arrived in " + d.target_location +": " + d.year_start);
    });
    

}

d3.csv("https://eam5.github.io/atlanticsynagogues/assets/data/rabbi_locations_network.csv", function(data) {
    _.each(data, function(link, i, data){
        link.sourceTarget = link.source_location + "  to " + link.target_location
        link.start = parseFloat(link.year_start)
        link.end = parseFloat(link.year_end)
    } )
    
    const allYears = _.chain(data)
     .filter(t=>t.sourceX != "")
     .groupBy(t=>t.sourceTarget)
     .map(function(t){
         return {
             sourceTarget: t[0].sourceTarget,
             source_location: t[0].source_location,
             sourceX: parseFloat(t[0].sourceX),
             sourceY: parseFloat(t[0].sourceY),
             target_location: t[0].target_location,
             targetX: parseFloat(t[0].targetX),
             targetY: parseFloat(t[0].targetY),
             amount: t.length,
             rabbis: t,
             minYear: d3.min(t.map(d=>d.start)),
             maxYear: d3.max(t.map(d=>d.start))
         }
     })
     .sort(function(a, b) {
        return a.sourceTarget.localeCompare(b.sourceTarget);
    })
    .value();
    
     const data1650 = _.chain(data)
     .filter(t=>t.sourceX != "")
     .filter(d=>(d.year_start < 1650 && d.year_start!=""))
     .groupBy(t=>t.sourceTarget)
     .map(function(t){
         return {
             sourceTarget: t[0].sourceTarget,
             source_location: t[0].source_location,
             sourceX: parseFloat(t[0].sourceX),
             sourceY: parseFloat(t[0].sourceY),
             target_location: t[0].target_location,
             targetX: parseFloat(t[0].targetX),
             targetY: parseFloat(t[0].targetY),
             amount: t.length,
             rabbis: t,
             minYear: d3.min(t.map(d=>d.start)),
             maxYear: d3.max(t.map(d=>d.start))
         }
     })
     .sort(function(a, b) {
        return a.sourceTarget.localeCompare(b.sourceTarget);
    })
    .value();
    
    const data1700 = _.chain(data)
     .filter(t=>t.sourceX != "")
     .filter(d=>(d.year_start >= 1650 && d.year_start <1700 && d.year_start!=""))
     .groupBy(t=>t.sourceTarget)
     .map(function(t){
         return {
             sourceTarget: t[0].sourceTarget,
             source_location: t[0].source_location,
             sourceX: parseFloat(t[0].sourceX),
             sourceY: parseFloat(t[0].sourceY),
             target_location: t[0].target_location,
             targetX: parseFloat(t[0].targetX),
             targetY: parseFloat(t[0].targetY),
             amount: t.length,
             rabbis: t,
             minYear: d3.min(t.map(d=>d.start)),
             maxYear: d3.max(t.map(d=>d.start))
         }
     })
     .sort(function(a, b) {
        return a.sourceTarget.localeCompare(b.sourceTarget);
    })
    .value();
    
    const data1750 = _.chain(data)
     .filter(t=>t.sourceX != "")
     .filter(d=>(d.year_start >= 1700 && d.year_start <1750 && d.year_start!=""))
     .groupBy(t=>t.sourceTarget)
     .map(function(t){
         return {
             sourceTarget: t[0].sourceTarget,
             source_location: t[0].source_location,
             sourceX: parseFloat(t[0].sourceX),
             sourceY: parseFloat(t[0].sourceY),
             target_location: t[0].target_location,
             targetX: parseFloat(t[0].targetX),
             targetY: parseFloat(t[0].targetY),
             amount: t.length,
             rabbis: t,
             minYear: d3.min(t.map(d=>d.start)),
             maxYear: d3.max(t.map(d=>d.start))
         }
     })
     .sort(function(a, b) {
        return a.sourceTarget.localeCompare(b.sourceTarget);
    })
    .value();
    
    const data1800 = _.chain(data)
     .filter(t=>t.sourceX != "")
     .filter(d=>(d.year_start >= 1750 && d.year_start <1800 && d.year_start!=""))
     .groupBy(t=>t.sourceTarget)
     .map(function(t){
         return {
             sourceTarget: t[0].sourceTarget,
             source_location: t[0].source_location,
             sourceX: parseFloat(t[0].sourceX),
             sourceY: parseFloat(t[0].sourceY),
             target_location: t[0].target_location,
             targetX: parseFloat(t[0].targetX),
             targetY: parseFloat(t[0].targetY),
             amount: t.length,
             rabbis: t,
             minYear: d3.min(t.map(d=>d.start)),
             maxYear: d3.max(t.map(d=>d.start))
         }
     })
     .sort(function(a, b) {
        return a.sourceTarget.localeCompare(b.sourceTarget);
    })
    .value();
    
    const dataAmstSource = _.chain(data)
     .filter(t=>t.sourceX != "")
     .filter(d=>d.source_location=="Amsterdam, Netherlands")
     .groupBy(t=>t.sourceTarget)
     .map(function(t){
         return {
             sourceTarget: t[0].sourceTarget,
             source_location: t[0].source_location,
             sourceX: parseFloat(t[0].sourceX),
             sourceY: parseFloat(t[0].sourceY),
             target_location: t[0].target_location,
             targetX: parseFloat(t[0].targetX),
             targetY: parseFloat(t[0].targetY),
             amount: t.length,
             rabbis: t,
             minYear: d3.min(t.map(d=>d.start)),
             maxYear: d3.max(t.map(d=>d.start))
         }
     })
     .sort(function(a, b) {
        return a.sourceTarget.localeCompare(b.sourceTarget);
    })
    .value();
    
     const dataLondon = _.chain(data)
     .filter(t=>t.sourceX != "")
     .filter(d=>d.target_location=="London, England" || d.source_location=="London, England")
     .groupBy(t=>t.sourceTarget)
     .map(function(t){
         return {
             sourceTarget: t[0].sourceTarget,
             source_location: t[0].source_location,
             sourceX: parseFloat(t[0].sourceX),
             sourceY: parseFloat(t[0].sourceY),
             target_location: t[0].target_location,
             targetX: parseFloat(t[0].targetX),
             targetY: parseFloat(t[0].targetY),
             amount: t.length,
             rabbis: t,
             minYear: d3.min(t.map(d=>d.start)),
             maxYear: d3.max(t.map(d=>d.start))
         }
     })
    .value();
    
    const dataCuracaoSource = _.chain(data)
     .filter(t=>t.sourceX != "")
     .filter(d=>d.source_location=="Willemstad, Curacao")
     .groupBy(t=>t.sourceTarget)
     .map(function(t){
         return {
             sourceTarget: t[0].sourceTarget,
             source_location: t[0].source_location,
             sourceX: parseFloat(t[0].sourceX),
             sourceY: parseFloat(t[0].sourceY),
             target_location: t[0].target_location,
             targetX: parseFloat(t[0].targetX),
             targetY: parseFloat(t[0].targetY),
             amount: t.length,
             rabbis: t,
             minYear: d3.min(t.map(d=>d.start)),
             maxYear: d3.max(t.map(d=>d.start))
         }
     })
    .value();
    
    const dataNYTarget = _.chain(data)
     .filter(t=>t.sourceX != "")
     .filter(d=>d.target_location=="New York, United States" || d.source_location=="New York, United States")
     .groupBy(t=>t.sourceTarget)
     .map(function(t){
         return {
             sourceTarget: t[0].sourceTarget,
             source_location: t[0].source_location,
             sourceX: parseFloat(t[0].sourceX),
             sourceY: parseFloat(t[0].sourceY),
             target_location: t[0].target_location,
             targetX: parseFloat(t[0].targetX),
             targetY: parseFloat(t[0].targetY),
             amount: t.length,
             rabbis: t,
             minYear: d3.min(t.map(d=>d.start)),
             maxYear: d3.max(t.map(d=>d.start))
         }
     })
    .value();
    
     const dataNewportTarget = _.chain(data)
     .filter(t=>t.sourceX != "")
     .filter(d=>d.target_location=="Newport, United States" || d.idpeople=="25")
     .groupBy(t=>t.sourceTarget)
     .map(function(t){
         return {
             sourceTarget: t[0].sourceTarget,
             source_location: t[0].source_location,
             sourceX: parseFloat(t[0].sourceX),
             sourceY: parseFloat(t[0].sourceY),
             target_location: t[0].target_location,
             targetX: parseFloat(t[0].targetX),
             targetY: parseFloat(t[0].targetY),
             amount: t.length,
             rabbis: t,
             minYear: d3.min(t.map(d=>d.start)),
             maxYear: d3.max(t.map(d=>d.start))
         }
     })
     .sort(function(a, b) {
        return a.sourceTarget.localeCompare(b.sourceTarget);
    })
    .value();
    
    addLayer2(data1650, springs);

    d3.select('#allYears').on('click', function(d){
            d3.select(map.getPanes().overlayPane).select("svg").remove();
            d3.select("#title h3").remove();
             d3.selectAll("#travel").text("");
             d3.selectAll(".tweet").remove();
             addLayer2(allYears, springs);
        });
    d3.select('#button1').on('click', function(d){
            d3.select(map.getPanes().overlayPane).select("svg").remove();
            d3.select("#title h3").remove();
             d3.selectAll("#travel").text("");
             d3.selectAll(".tweet").remove();
             addLayer2(data1650, springs);
        });
    d3.select('#button2').on('click', function(d){
            d3.select(map.getPanes().overlayPane).select("svg").remove();
            d3.select("#title h3").remove();
             d3.selectAll("#travel").text("");
             d3.selectAll(".tweet").remove();
             addLayer2(data1700, springs);
        });
    d3.select('#button3').on('click', function(d){
            d3.select(map.getPanes().overlayPane).select("svg").remove();
            d3.select("#title h3").remove();
             d3.selectAll("#travel").text("");
             d3.selectAll(".tweet").remove();
             addLayer2(data1750, springs);
        });
    d3.select('#button4').on('click', function(d){
            d3.select(map.getPanes().overlayPane).select("svg").remove();
            d3.select("#title h3").remove();
             d3.selectAll("#travel").text("");
             d3.selectAll(".tweet").remove();
             addLayer2(data1800, springs);
        });
    d3.select('#buttonAmst').on('click', function(d){
            d3.select(map.getPanes().overlayPane).select("svg").remove();
            d3.select("#title h3").remove();
             d3.selectAll("#travel").text("");
             d3.selectAll(".tweet").remove();
             addLayer2(dataAmstSource, springs);
        });
    d3.select('#buttonLondon').on('click', function(d){
            d3.select(map.getPanes().overlayPane).select("svg").remove();
            d3.select("#title h3").remove();
             d3.selectAll("#travel").text("");
             d3.selectAll(".tweet").remove();
             addLayer2(dataLondon, springs);
        });
    d3.select('#buttonCuracao').on('click', function(d){
            d3.select(map.getPanes().overlayPane).select("svg").remove();
            d3.select("#title h3").remove();
             d3.selectAll("#travel").text("");
             d3.selectAll(".tweet").remove();
             addLayer2(dataCuracaoSource, springs);
        });
    d3.select('#buttonNY').on('click', function(d){
            d3.select(map.getPanes().overlayPane).select("svg").remove();
            d3.select("#title h3").remove();
             d3.selectAll("#travel").text("");
             d3.selectAll(".tweet").remove();
             addLayer2(dataNYTarget, springs);
        });
    d3.select('#buttonNewport').on('click', function(d){
             d3.select(map.getPanes().overlayPane).select("svg").remove();
            d3.select("#title h3").remove();
             d3.selectAll("#travel").text("");
             d3.selectAll(".tweet").remove();
             addLayer2(dataNewportTarget, springs);
        });
    
   
});
    

function update() {
    d3.selectAll(".links")
        .attr("d", function(d){
            var sourcePt = map.latLngToLayerPoint([d.sourceX, d.sourceY])
            var targetPt = map.latLngToLayerPoint([d.targetX, d.targetY])
            var dx = targetPt.x - sourcePt.x,
            dy = targetPt.y - sourcePt.y,
            dr = Math.sqrt(dx * dx + dy * dy);
            return "M" + sourcePt.x + "," + sourcePt.y + "A" + dr + "," + dr + " 0 0,1 " + targetPt.x + "," + targetPt.y;
        });
}

map.on("moveend", update)

function refreshPage(){
    window.location.reload();
} 
</script>
  </div>
    
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
</body>
</html>
    